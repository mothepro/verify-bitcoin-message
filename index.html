<!DOCTYPE html>
<html
  lang="en"
  data-theme="light"
>

<head>
  <meta charset="UTF-8">
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  >
  <title>Message Verifier</title>
  <link
    rel="stylesheet"
    href="./css/pico.min.css"
  >
  <style>
    #verified-message-content {
      background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
      border: 1px solid #c3e6cb;
      border-radius: var(--pico-border-radius);
      padding: 1rem;
      margin: 1rem 0;
    }

    pre {
      border: 1px solid #c3e6cb;
      border-radius: var(--pico-border-radius);
      padding: 1rem;
      margin: 1rem 0;
      white-space: break-spaces;
    }

    .hero {
      text-align: center;
      padding: 2rem 0;
    }

    .hero h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .hero p {
      font-size: 1.2rem;
      color: var(--pico-muted-color);
      margin-bottom: 2rem;
    }

    .signature-info {
      background: var(--pico-card-background-color);
      border: 1px solid var(--pico-card-border-color);
      border-radius: var(--pico-border-radius);
      padding: 1.5rem;
      margin: 1rem 0;
    }

    .failed {
      border-color: var(--pico-del-color);
      background: var(--pico-del-background-color);
    }

    .address-link {
      color: var(--pico-primary-color);
      text-decoration: none;
      font-family: monospace;
      font-weight: bold;
    }

    .address-link:hover {
      text-decoration: underline;
    }

    .hidden {
      display: none !important;
    }

    .actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      margin: 2rem 0;
    }

    .education {
      margin: 3rem 0;
      padding: 2rem;
      /* border-top: 1px solid var(--pico-muted-border-color); */
    }

    .education h2 {
      color: var(--pico-primary-color);
    }

    .alternatives {
      margin-top: 2rem;
      font-size: 0.9rem;
      color: var(--pico-muted-color);
    }

    .alternatives>a {
      display: block;
      margin-bottom: var(--pico-spacing)
    }

    #valid-payloads a {
      display: inline-block;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }

    #verify-dialog footer {
      display: flex;
    }

    details.indent[open]>* {
      margin-inline-start: 3rem;
    }

    details.indent[open]>summary {
      margin-inline-start: 0;
    }

    .flex {
      display: flex;
      gap: var(--pico-spacing);
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: var(--pico-spacing);
    }

    .flex .one {
      flex: 1 1 10rem;
    }
  </style>
</head>

<body>
  <main class="container">
    <!-- Hero Section (shown when no message) -->
    <div
      id="hero"
      class="hero"
    >
      <h1>Message Verifier</h1>
      <p>Authenticate signed messages on your device &mdash; <i>even in airplane mode</i></p>
      <noscript>
        Please enable JavaScript in your browser, cannot verify messages without it.
      </noscript>
    </div>
    <!-- Verified Message Display (shown when message is verified) -->
    <div class="verified-display hidden">
      <div class="signature-info">
        <h2>✅ Verified Message</h2>
        <p>
          <a
            id="verified-address-link"
            class="address-link"
            target="_blank"
            rel="noopener noreferrer"
          ></a> cryptographically signed
        </p>
      </div>

      <pre id="verified-message-content"></pre>
    </div>

    <!-- Error Display (shown when verification fails) -->
    <div class="error-display hidden">
      <div class="signature-info failed">
        <h2>❌ Verification Failed</h2>
      </div>
    </div>

    <!-- Verification Dialog -->
    <dialog id="verify-dialog">
      <article>
        <form
          method="get"
          id="verifyForm"
          action=""
        >
          <input
            required
            type="text"
            id="address"
            name="address"
            placeholder="Bitcoin Address"
          />
          <textarea
            required
            id="message"
            name="message"
            aria-label="Message"
            rows="9"
            placeholder="Message (Hex strings must start with '0x')

It's a good idea to include on of these
- a timestamp
- opentimestamps.org
- the top bitcoin blockchain hash"
          ></textarea>
          <input
            type="text"
            id="signature"
            name="signature"
            required
            placeholder="Signature (Base64 encoded)"
          />
        </form>

        <footer>
          <button
            type="button"
            aria-label="Close"
            class="secondary"
            onclick="document.getElementById('verify-dialog').close()"
          >Cancel</button>
          <button
            type="submit"
            form="verifyForm"
            class="primary"
          >Verify</button>
        </footer>
      </article>
    </dialog>

    <!-- Educational Content -->
    <article class="education">
      <!-- <h3>Message signed by a Bitcoin private key</h3> -->

      <p>Digital signatures cryptographically prove</p>

      <ul>
        <li><strong>Authentication</strong> The signer can spend bitcoin from the address</li>
        <li><strong>Integrity</strong> The message has not been altered since it was signed</li>
        <li><strong>Non-repudiation</strong> The signer cannot deny having signed the message</li>
      </ul>

      Using the <a
        href="https://www.npmjs.com/package/verify-bitcoin-message"
        target="_blank"
        rel="noopener noreferrer"
        data-tooltip="This JavaScript library provides one line of code to verify signed messages"
      >verify-bitcoin-message</a> library, you can verify signatures in your browser without an internet connection.
    </article>

    <div class="alternatives">
      <div class="flex">
        <a
          href="https://github.com/mothepro/verify-bitcoin-message/pulls"
          target="_blank"
          rel="noopener noreferrer"
          role="button"
          class="one secondary"
        >Published messages</a>

        <button
          onclick="document.getElementById('verify-dialog').showModal()"
          class="one primary"
        >Verify any Message</button>
      </div>
      <details class="hidden">
        <summary>
          Payloads
        </summary>
        <ol id="valid-payloads"></ol>
      </details>
      <details>
        <summary
          role="button"
          class="secondary"
        >How it works</summary>
        <article>

          <p>
            <a
              href="https://en.wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm"
              target="_blank"
              rel="noopener noreferrer"
            >Elliptic curve cryptography</a> makes it possible for
          <ul>
            <li>A private key to sign messages</li>
            <li>Its corresponding <a
                href="https://en.wikipedia.org/wiki/Public-key_cryptography"
                target="_blank"
                rel="noopener noreferrer"
              >public key</a>s to verify the signatures</li>
            <li>The <a
                href="https://en.wikipedia.org/wiki/Digital_signature"
                target="_blank"
                rel="noopener noreferrer"
              >signatures</a> never leak the private key</li>
          </ul>
          </p>

          <p>
            Not only does <abbr
              title="Elliptic Curve Digital Signature Algorithm"
              data-tooltip="Elliptic Curve Digital Signature Algorithm"
            >ECDSA</abbr> provide security for every
            day internet communication, it's also used to secure Bitcoin.
          </p>

          <p>
            Bitcoin uses the following cryptographic primitives
          <ul>
            <li>
              <a
                href="https://en.bitcoin.it/wiki/Secp256k1"
                target="_blank"
                rel="noopener noreferrer"
              >secp256k1</a> as the elliptic curve
            </li>
            <li>
              <a
                href="https://en.wikipedia.org/wiki/RIPEMD"
                target="_blank"
                rel="noopener noreferrer"
              >RIPEMD-160</a>
              and
              <a
                href="https://en.wikipedia.org/wiki/SHA-2"
                target="_blank"
                rel="noopener noreferrer"
              >SHA-256</a> hash functions
            </li>
            <li><a
                href="https://en.bitcoin.it/wiki/Base58Check_encoding"
                target="_blank"
                rel="noopener noreferrer"
              >Base58Check encoding</a> for converting public keys to Bitcoin addresses</li>
          </ul>
          </p>
        </article>
      </details>
      <details class="hidden verify-attempted-display">
        <summary
          role="button"
          class="secondary"
        >
          <span class="verified-display">
            Publish this message
          </span>
          <span class="error-display">
            Reason for failure
          </span>
        </summary>
        <p id="error-reason">The signature could not be verified for the provided message and address.</p>
        <pre id="json-stringify"></pre>
        <a
          href="https://github.com/mothepro/verify-bitcoin-message/edit/main/payloads.json"
          target="_blank"
          rel="noopener noreferrer"
          class="primary verified-display"
          role="button"
        >Paste &amp; Publish</a>
      </details>

      <details
        open
        class="indent"
        class="verify-completed-display-close"
      >
        <summary
          role="button"
          class="outline"
        >Other ways to verify signed messages</summary>

        <details>
          <summary
            role="button"
            class="secondary"
          >Bitcoin Node</summary>

          Command Line
          <pre><code>
bitcoin-cli verifymessage &lt;address&gt; &lt;signature&gt; &lt;message&gt;
</code></pre>

          RPC
          <pre><code>
curl
  --user &lt;rpcuser&gt;:&lt;rpcpassword&gt; \
  --data-binary '{"jsonrpc": "1.0", "id":"curltest", "method": "verifymessage", "params": [&lt;address&gt;, &lt;signature&gt;, &lt;message&gt;] }' \
  -H 'content-type: text/plain;' \
  http://127.0.0.1:8332/
          </code></pre>
        </details>

        <details>
          <summary
            role="button"
            class="secondary"
          >JavaScript</summary>

          Command Line
          <pre><code>
npx verify-bitcoin-message --json \
  --address 1F3sAm6ZtwLAUnj7d38pGFxtP3RVEvtsbV \
  --message "This is an example of a signed message." \
  --signature "H9L5yLFjti0QTHhPyFrZCT1V/MMnBtXKmoiKDZ78NDBjERki6ZTQZdSMCtkgoNmp17By9ItJr8o7ChX0XxY91nk="
            </code></pre>

          Browser
          <pre><code>
&lt;script type="module"&gt;
  import verify, { verifySafe } from 'https://unpkg.com/verify-bitcoin-message';
&lt;/script&gt;

<!-- TODO: Verify this actually works -->
&lt;!-- Legacy Script Tag --&gt;
&lt;script type="text/javascript" src="https://unpkg.com/verify-bitcoin-message"&gt;
&lt;/script&gt;
            </code></pre>

          Node
          <pre><code>
npm install verify-bitcoin-message
            </code></pre>

          Bun
          <pre><code>
bun add verify-bitcoin-message
            </code></pre>

          Usage
          <pre><code>
import verify, { verifySafe } from 'verify-bitcoin-message';

await verify({
  address: '1F3sAm6ZtwLAUnj7d38pGFxtP3RVEvtsbV',
  message: 'This is an example of a signed message.',
  signature: 'H9L5yLFjti0QTHhPyFrZCT1V/MMnBtXKmoiKDZ78NDBjERki6ZTQZdSMCtkgoNmp17By9ItJr8o7ChX0XxY91nk='
})

// If you're not a fan of throwing errors:
const isValid = await verifySafe({
  address: '1F3sAm6ZtwLAUnj7d38pGFxtP3RVEvtsbV',
  message: 'This is an example of a signed message.',
  signature: 'H9L5yLFjti0QTHhPyFrZCT1V/MMnBtXKmoiKDZ78NDBjERki6ZTQZdSMCtkgoNmp17By9ItJr8o7ChX0XxY91nk='
})
            </code></pre>
        </details>

        <details>
          <summary
            role="button"
            class="secondary"
          >Websites</summary>

          <ul>
            <li>
              <a
                href="https://www.bitcoin.com/tools/verify-message/"
                target="_blank"
                rel="noopener noreferrer"
              >Bitcoin.com</a>
              <br />
              <img
                alt="Closed Source"
                src="https://img.shields.io/badge/source-closed-red"
              />

            </li>
            <li>
              <a
                href="https://www.verifybitcoinmessage.com/"
                target="_blank"
                rel="noopener noreferrer"
              >Verify Bitcoin Message</a>
              <br />
              <img
                alt="Closed Source"
                src="https://img.shields.io/badge/source-closed-red"
              />
            </li>
            <li>
              <a
                href="https://bluewallet.github.io/VerifySignature?a=&m=&s="
                id="blue-wallet-link"
                target="_blank"
                rel="noopener noreferrer"
              >BlueWallet's VerifySignature</a>
              <br />
              <img
                alt="Open Source"
                src="https://img.shields.io/badge/source-Open-success"
              >
              <br />
              <img
                alt="Offline First"
                src="https://img.shields.io/badge/Internet-Not_Required-success"
              />
              <br />
              <a
                href="https://npmgraph.js.org/?q=bitcoinjs-message"
                target="_blank"
                rel="noopener noreferrer"
              ><img
                  alt="68 Dependencies"
                  src="https://img.shields.io/badge/dependencies-68-yellow"
                ></a>
            </li>
          </ul>
        </details>

        <a
          href="https://github.com/mothepro/verify-bitcoin-message#verify-bitcoin-message"
          target="_blank"
          rel="noopener noreferrer"
          role="button"
          style="display: block"
          class="outline primary"
        >Check out the source code</a>

      </details>
    </div>
  </main>

  <script
    type="module"
    src="./demo.js"
  ></script>
</body>

</html>
