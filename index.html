<!DOCTYPE html>
<html
  lang="en"
  data-theme="light"
>

<head>
  <meta charset="UTF-8">
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  >
  <title>Message Verifier</title>
  <meta
    name="description"
    content="A dependency-free Bitcoin message signature verifier that works offline"
  >
  <meta
    name="theme-color"
    content="#f97316"
  >
  <meta
    name="apple-mobile-web-app-capable"
    content="yes"
  >
  <meta
    name="apple-mobile-web-app-status-bar-style"
    content="default"
  >
  <meta
    name="apple-mobile-web-app-title"
    content="BTC Verify"
  >
  <meta
    name="mobile-web-app-capable"
    content="yes"
  >
  <link
    rel="icon"
    href="favicon.svg"
    type="image/svg+xml"
  >
  <link
    rel="apple-touch-icon"
    href="favicon.svg"
  >
  <link
    rel="manifest"
    href="manifest.json"
  >

  <link
    rel="stylesheet"
    href="./css/pico.min.css"
  >
  <style>
    /* Dark theme overrides */
    :host(:not([data-theme="light"])),
    :root:not([data-theme="light"]),
    [data-theme="dark"] {
      --pico-primary: #f97316;
      --pico-primary-background: #f97316;
      --pico-primary-border: #f97316;
      --pico-primary-underline: #f97316;
      --pico-primary-hover: #fb923c;
      --pico-primary-hover-background: #fb923c;
      --pico-primary-hover-border: #fb923c;
      --pico-primary-focus: #f97316;
      --pico-primary-inverse: #ffffff;
    }

    /* Light theme overrides */
    :host(:not([data-theme="dark"])),
    :root:not([data-theme="dark"]),
    [data-theme="light"] {
      --pico-primary: #f97316;
      --pico-primary-background: #f97316;
      --pico-primary-border: #f97316;
      --pico-primary-underline: #f97316;
      --pico-primary-hover: #ea580c;
      --pico-primary-hover-background: #ea580c;
      --pico-primary-hover-border: #ea580c;
      --pico-primary-focus: #f97316;
      --pico-primary-inverse: #ffffff;
    }

    html,
    body {
      min-height: 100vh;
      scrollbar-gutter: stable;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .verified-display-true {
      background: linear-gradient(135deg, hsl(134.4deg 40.98% 88.04%) 0%, hsl(133.71deg 64.58% 69.3%) 100%);
    }

    .error-display-true {
      background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
    }

    .monospace {
      font-family: monospace;
      white-space: break-spaces;
    }

    pre {
      border: 1px solid #c3e6cb;
      border-radius: var(--pico-border-radius);
      padding: 1rem;
      margin: 1rem 0;
      white-space: break-spaces;
    }

    .block {
      display: block !important;
    }

    .text-center {
      text-align: center;
    }

    .hero {
      padding-top: 2rem;
    }

    .hero h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .hero p {
      font-size: 1.2rem;
      color: var(--pico-muted-color);
      margin-bottom: 2rem;
    }

    .failed {
      border-color: var(--pico-del-color);
      background: var(--pico-del-background-color);
    }

    a.no-line {
      text-decoration: none;
      color: var(--pico-primary-color);
    }

    .address-link {
      color: var(--pico-primary-color);
      font-family: monospace;
      font-weight: bold;
    }

    .address-link:hover {
      text-decoration: dotted;
    }

    .align-start {
      text-align: start;
    }

    .hidden {
      display: none !important;
    }

    .actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      margin: 2rem 0;
    }

    article {
      margin: 3rem 0;
      padding: 2rem;
      /* border-top: 1px solid var(--pico-muted-border-color); */
    }

    article h2 {
      color: var(--pico-primary-color);
    }

    .alternatives {
      margin-top: 2rem;
      color: var(--pico-muted-color);
    }

    .alternatives>a {
      display: block;
      margin-bottom: var(--pico-spacing)
    }

    .bg-white {
      background: white;
    }

    a.message {
      display: block;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
      text-align: start;
      margin-bottom: var(--pico-spacing);
    }

    details.indent[open]>* {
      margin-inline-start: 3rem;
    }

    details.indent[open]>summary {
      margin-inline-start: 0;
    }

    .flex {
      display: flex;
      gap: var(--pico-spacing);
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: var(--pico-spacing);
    }

    .space {
      margin-bottom: var(--pico-spacing);
    }

    .w-full {
      width: 100%;
    }

    .flex .one {
      flex: 1 1 10rem;
    }

    .flex-only {
      display: flex;
    }

    .inline-block {
      display: inline-block;
    }

    .m-0 {
      margin: 0;
    }

    .mt-2 {
      margin-top: 2rem;
    }

    span.newline::before {
      content: '\\';
      white-space: pre;
    }

    hr {
      margin: 2rem 0;
    }
  </style>
</head>

<body>
  <main class="container">
    <div class="hero no-attempt-display text-center">
      <h1>Message Verifier</h1>
      <p>Authenticate signed messages on your device &mdash; <i>even in airplane mode</i></p>
      <noscript>
        Please enable JavaScript in your browser, cannot verify messages without it.
      </noscript>
    </div>

    <div class="verified-display hidden hero text-center">
      <h1><a
          href="/"
          class="no-line"
        >Verified ‚úÖ</a></h1>
    </div>


    <div class="error-display hidden hero text-center">
      <h1><a
          href="/"
          class="no-line"
        >Verification Failed ‚ùå</a></h1>
    </div>

    <article
      id="verified-message-content"
      class="monospace verified-display hidden"
    ></article>

    <dialog id="verify-dialog">
      <article>
        <form
          method="get"
          id="verifyForm"
          action=""
        >
          <input
            required
            type="text"
            id="address"
            name="address"
            placeholder="Bitcoin Address (Legacy only)"
          />
          <textarea
            required
            id="message"
            name="message"
            aria-label="Message"
            rows="9"
            placeholder="Message (Hex strings must start with '0x')

It's a good idea to include on of these
- a timestamp
- opentimestamps.org
- the top bitcoin blockchain hash"
          ></textarea>
          <input
            required
            type="text"
            id="signature"
            name="signature"
            placeholder="Signature (Base64 encoded)"
            autocomplete="off"
          />
        </form>

        <footer>
          <div class="flex-only">
            <button
              type="button"
              aria-label="Close"
              class="secondary"
              onclick="document.getElementById('verify-dialog').close()"
            >Cancel</button>
            <button
              type="submit"
              form="verifyForm"
              class="primary"
            >Verify</button>
          </div>

          <!-- <hr> -->
          <details class="align-start hidden">
            <summary
              role="button"
              class="outline bg-white"
              type="button"
            >
              More options if you do not have access to signing a message
            </summary>

            <div class="align-start">
              <p class="inline-block mt-2">
                Sign your own messages online for free
              </p>
              <a
                href="https://brainwalletx.github.io/#sign"
                target="_blank"
                rel="noopener noreferrer"
                role="button"
                class="outline bg-white contrast align-start"
              >via BrainWallet</a>
            </div>
          </details>
        </footer>
      </article>
    </dialog>

    <article>
      <p class="hidden text-center verified-display">
        <a
          id="verified-address-link"
          class="address-link"
          target="_blank"
          rel="noopener noreferrer"
        ></a> digitally signed this message
      </p>

      <p class="hidden text-center error-display">
        The message has been tampered with, or it was not signed by the provided address.
      </p>
      <p class="hidden text-center error-display">
        When verification passes, digital signatures cryptographically prove
        <abbr data-tooltip="It is cryptographically impossible to forge a valid signature">
          tamper-resistance
        </abbr>
        and
        <abbr data-tooltip="The signer, or owner of the address, cannot deny having signed the message">
          non-repudiablity
        </abbr>
      </p>

      <p class="text-center no-attempt-display">
        Digitally signed messages are
        <abbr data-tooltip="It is cryptographically impossible to forge a valid signature">
          tamper-resistant
        </abbr>
        and
        <abbr data-tooltip="The signer, or owner of the address, cannot deny having signed the message">
          non-repudiable
        </abbr>
      </p>

      <hr />

      <button
        onclick="document.getElementById('verify-dialog').showModal()"
        class="one primary block space w-full"
      >Verify any Message</button>

      <a
        data-href-payload="0"
        data-inner-message="0"
        data-message="oneline"
        rel="noopener noreferrer"
        role="button"
        class="one align-start outline no-attempt-display block space"
      >Message from Mo</a>

      <a
        href="https://github.com/mothepro/verify-bitcoin-message/pulls?q=is%3Apr+is%3Aopen+-is%3Adraft"
        target="_blank"
        rel="noopener noreferrer"
        role="button"
        class="one align-start outline verified-display block space"
      >üåç Messages from around the world </a>

      <details class="hidden verify-attempted-display">
        <summary
          role="button"
          class="outline bg-white"
        >
          <span class="verified-display">
            üì¢ Details &amp; Publish
          </span>
          <span class="error-display">
            ‚õî Reason for failure &amp; Details
          </span>
        </summary>
        <p id="error-reason"></p>
        <pre id="json-stringify"></pre>
        <p class="text-center">
          Verification finished in <span data-duration></span>ms
        </p>
        <div class="flex">
          <button
            id="json-stringify-select-all"
            class="secondary one"
          >Copy</button>
          <a
            href="https://github.com/mothepro/verify-bitcoin-message/edit/main/payloads.json"
            target="_blank"
            rel="noopener noreferrer"
            class="primary verified-display one"
            role="button"
          >Publish via Github</a>
        </div>
      </details>
      <details class="indent">
        <summary
          role="button"
          class="outline bg-white m-0"
        >üéì How it works</summary>

        <p class="hidden">
          Learn how it works in only 3 minutes
        </p>

        <details>
          <summary
            role="button"
            class="outline bg-white"
          >Asymmetric cryptography</summary>
          <p>
            Also known as <a
              href="https://en.wikipedia.org/wiki/Public-key_cryptography"
              target="_blank"
              rel="noopener noreferrer"
            >public-key cryptography</a>, allows for secure communication between two parties.
          </p>

          <p>
            Each party creating <i data-tooltip="Hence the asymmetrical naming">a pair of unique</i> keys, a
            public key and a private key.
          </p>

          <p>
            Private keys are used to <a
              href="https://en.wikipedia.org/wiki/Digital_signature"
              target="_blank"
              rel="noopener noreferrer"
            >digitally sign</a> messages, then the corresponding public keys are used to verify those message
            signatures.
          </p>
        </details>

        <details>
          <summary
            role="button"
            class="outline bg-white"
          >Elliptic curves</summary>
          <p>
            <a
              href="https://en.wikipedia.org/wiki/Elliptic_curve_cryptography"
              target="_blank"
              rel="noopener noreferrer"
            >Elliptic curve cryptography</a> is a very common implementation of asymmetric cryptography.
          </p>

          <p>
            It&apos;s used to secure every day internet communication, peer-to-peer messaging (whatsapp, signal, etc.)
            and even bitcoin.
          </p>

          <p>
            <a
              href="https://en.wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm"
              target="_blank"
              rel="noopener noreferrer"
              data-tooltip="ECDSA"
            >Elliptic Curve Digital Signature Algorithm</a> ensures that the digital signatures cannot be forged and do
            not leak the private key.
          </p>

          <p>
            What makes this so secure is the difficulty of solving the <a
              href="https://en.wikipedia.org/wiki/Elliptic_curve_discrete_logarithm_problem"
              target="_blank"
              rel="noopener noreferrer"
              data-tooltip="ECDLP"
            >Elliptic Curve Discrete Logarithm Problem</a>.
          </p>
        </details>

        <details>
          <summary
            role="button"
            class="outline bg-white"
          >Bitcoin</summary>
          <p>
            Bitcoin uses the following cryptographic primitives
          <ul>
            <li>
              <a
                href="https://en.bitcoin.it/wiki/Secp256k1"
                target="_blank"
                rel="noopener noreferrer"
              >secp256k1</a> as the elliptic curve
            </li>
            <li>
              <a
                href="https://en.wikipedia.org/wiki/RIPEMD"
                target="_blank"
                rel="noopener noreferrer"
              >RIPEMD-160</a>
              and
              <a
                href="https://en.wikipedia.org/wiki/SHA-2"
                target="_blank"
                rel="noopener noreferrer"
              >SHA-256</a> hash functions
            </li>
            <li><a
                href="https://en.bitcoin.it/wiki/Base58Check_encoding"
                target="_blank"
                rel="noopener noreferrer"
              >Base58Check encoding</a> for converting public keys to Bitcoin addresses</li>
          </ul>
          </p>
        </details>

        <details>
          <summary
            role="button"
            class="outline bg-white"
          >Message Verifier</summary>
          <p>
            This website uses the <a
              href="https://www.npmjs.com/package/verify-bitcoin-message"
              target="_blank"
              rel="noopener noreferrer"
              XXXdata-tooltip="This JavaScript library provides one line of code to verify signed messages"
            >verify-bitcoin-message</a> library to verify signatures on device &mdash; without an internet connection.

          </p>

          <p>
            All the core logic can be found in a single file, <a
              href="https://github.com/mothepro/verify-bitcoin-message/blob/main/verify.ts"
              target="_blank"
              rel="noopener noreferrer"
            >verify.ts</a>.
          </p>
        </details>
      </details>

      <details
        class="indent"
        class="verify-completed-display-close"
      >
        <summary
          role="button"
          class="outline bg-white"
        >
          <span class="no-attempt-display">
            üìú Other ways to verify signed messages
          </span>
          <span class="verify-attempted-display hidden">
            üîç Verify this Verification
          </span>
        </summary>

        <details>
          <summary
            role="button"
            class="outline bg-white"
          >Bitcoin Node</summary>

          Command Line
          <pre><code>
bitcoin-cli verifymessage <span class="display address">address</span> &quot;<span class="display signature">signature</span>&quot; &quot;<span class="display message">message</span>&quot;
</code></pre>

          RPC
          <pre><code>
curl --user &lt;rpcuser&gt;:&lt;rpcpassword&gt; <span class="newline"></span>
--data-binary '{"jsonrpc": "1.0", "id":"curltest", "method": "verifymessage", "params": [&quot;<span class="display address">address</span>&quot;, &quot;<span class="display signature">signature</span>&quot;, &quot;<span class="display message">message</span>&quot;] }' <span class="newline"></span>
-H 'content-type: text/plain;' <span class="newline"></span>
http://127.0.0.1:8332/
          </code></pre>
        </details>

        <details>
          <summary
            role="button"
            class="outline bg-white"
          >JavaScript</summary>

          Command Line
          <pre><code>
npx verify-bitcoin-message --json <span class="newline"></span>
--address <span class="display address">address</span> <span class="newline"></span>
--message &quot;<span class="display message">message</span>&quot; <span class="newline"></span>
--signature &quot;<span class="display signature">signature</span>&quot;
            </code></pre>

          Install in Browser
          <pre><code>
&lt;script type="module"&gt;
  import verify, { verifySafe } from 'https://unpkg.com/verify-bitcoin-message';
&lt;/script&gt;

<!-- TODO: Verify this actually works -->
&lt;!-- Legacy Script Tag --&gt;
&lt;script type="text/javascript" src="https://unpkg.com/verify-bitcoin-message"&gt;
&lt;/script&gt;
            </code></pre>

          Install via Node
          <pre><code>
npm i verify-bitcoin-message
            </code></pre>

          Install via Bun
          <pre><code>
bun add verify-bitcoin-message
            </code></pre>

          Usage
          <pre><code>
import verify, { verifySafe } from 'verify-bitcoin-message';

await verify({
  address: '<span class="display address">address</span>',
  message: '<span class="display message">message</span>',
  signature: '<span class="display signature">signature</span>'
})

// If you're not a fan of throwing errors:
const isValid = await verifySafe({
  address: '<span class="display address">address</span>',
  message: '<span class="display message">message</span>',
  signature: '<span class="display signature">signature</span>'
})
            </code></pre>
        </details>

        <details>
          <summary
            role="button"
            class="outline bg-white"
          >Other Websites</summary>

          <ul>
            <li>
              <a
                href="https://www.bitcoin.com/tools/verify-message/"
                target="_blank"
                rel="noopener noreferrer"
              >Bitcoin.com</a>
              <br />
              <img
                alt="Closed Source"
                src="https://img.shields.io/badge/source-closed-red"
              />

            </li>
            <li>
              <a
                href="https://www.verifybitcoinmessage.com/"
                target="_blank"
                rel="noopener noreferrer"
              >Verify Bitcoin Message</a>
              <br />
              <img
                alt="Closed Source"
                src="https://img.shields.io/badge/source-closed-red"
              />
            </li>
            <li>
              <a
                href="https://bluewallet.github.io/VerifySignature?a=&m=&s="
                id="blue-wallet-link"
                target="_blank"
                rel="noopener noreferrer"
              >BlueWallet's VerifySignature</a>
              <br />
              <img
                alt="Open Source"
                src="https://img.shields.io/badge/source-Open-success"
              >
              <br />
              <img
                alt="Offline First"
                src="https://img.shields.io/badge/Internet-Not_Required-success"
              />
              <br />
              <a
                href="https://npmgraph.js.org/?q=bitcoinjs-message"
                target="_blank"
                rel="noopener noreferrer"
              ><img
                  alt="68 Dependencies"
                  src="https://img.shields.io/badge/dependencies-68-yellow"
                ></a>
            </li>
          </ul>
        </details>
      </details>

      <a
        href="https://github.com/mothepro/verify-bitcoin-message#verify-bitcoin-message"
        target="_blank"
        rel="noopener noreferrer"
        role="button"
        class="outline bg-white primary block align-start"
      >üë®üèø‚Äçüíª Source Code</a>

      <!-- Eventually this and the published messages will be on the homescreen - right?! -->
      <div
        class="hidden"
        data-threshold="2"
      >
        <details
          class="verify-completed-display indent hidden"
          open
        >
          <summary
            role="button"
            class="outline bg-white"
          >
            More verified messages
          </summary>
          <div id="valid-payloads"></div>
        </details>
      </div>
      </div>
    </article>
  </main>

  <script
    type="module"
    src="./demo.js"
  ></script>
</body>

</html>
