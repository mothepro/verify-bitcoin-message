<!DOCTYPE html>
<html
  lang="en"
  data-theme="light"
>

<head>
  <meta charset="UTF-8">
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  >
  <title>Mo's Message Verifier</title>
  <link
    rel="stylesheet"
    href="./css/pico.min.css"
  >
  <style>
    #verified-message-content {
      background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
      border: 1px solid #c3e6cb;
      border-radius: var(--pico-border-radius);
      padding: 1rem;
      margin: 1rem 0;
    }

    pre {
      border: 1px solid #c3e6cb;
      border-radius: var(--pico-border-radius);
      padding: 1rem;
      margin: 1rem 0;
      white-space: break-spaces;
    }

    .hero {
      text-align: center;
      padding: 2rem 0;
    }

    .hero h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .hero p {
      font-size: 1.2rem;
      color: var(--pico-muted-color);
      margin-bottom: 2rem;
    }

    .signature-info {
      background: var(--pico-card-background-color);
      border: 1px solid var(--pico-card-border-color);
      border-radius: var(--pico-border-radius);
      padding: 1.5rem;
      margin: 1rem 0;
    }

    .address-link {
      color: var(--pico-primary-color);
      text-decoration: none;
      font-family: monospace;
      font-weight: bold;
    }

    .address-link:hover {
      text-decoration: underline;
    }

    .hidden {
      display: none !important;
    }

    .actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      margin: 2rem 0;
    }

    .education {
      margin-top: 3rem;
      padding-top: 2rem;
      border-top: 1px solid var(--pico-muted-border-color);
    }

    .education h2 {
      color: var(--pico-primary-color);
    }

    .alternatives {
      margin-top: 2rem;
      font-size: 0.9rem;
      color: var(--pico-muted-color);
    }

    #valid-payloads a {
      display: inline-block;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }

    #verify-dialog footer {
      display: flex;
    }
  </style>
</head>

<body>
  <main class="container">
    <!-- Hero Section (shown when no message) -->
    <div
      id="hero"
      class="hero"
    >
      <h1>Mo&apos;s Message Verifier</h1>
      <p>Cryptographically verify messages signed by Bitcoin private keys</p>
      <noscript>
        Please enable JavaScript in your browser, cannot verify messages without it.
      </noscript>

      <div class="actions">
        <button
          onclick="document.getElementById('verify-dialog').showModal()"
          class="primary"
        >Verify a Message</button>
      </div>
    </div>
    <!-- Verified Message Display (shown when message is verified) -->
    <div
      id="verified-display"
      class="hidden"
    >
      <div class="signature-info">
        <h2>‚úÖ Verified Message</h2>
        <p>The following message was cryptographically signed by
          <a
            id="verified-address-link"
            class="address-link"
            target="_blank"
            rel="noopener noreferrer"
          ></a>
        </p>
      </div>

      <pre id="verified-message-content"></pre>

      <div class="actions">
        <button
          type="button"
          onclick="document.getElementById('verify-dialog').showModal()"
          class="secondary"
        >Verify Another Message</button>
      </div>
    </div>

    <!-- Error Display (shown when verification fails) -->
    <div
      id="error-display"
      class="hidden"
    >
      <div
        class="signature-info"
        style="border-color: var(--pico-del-color); background: var(--pico-del-background-color);"
      >
        <details>
          <summary>
            <h2>‚ùå Verification Failed</h2>
          </summary>
          <p id="error-reason">The signature could not be verified for the provided message and address.</p>
        </details>
      </div>

      <div
        style="background: var(--pico-card-background-color); border: 1px solid var(--pico-card-border-color); border-radius: var(--pico-border-radius); padding: 1.5rem; margin: 1rem 0;"
      >
        <h3>üîí What This Proves</h3>
        <p><strong>This failed verification is actually a security feature!</strong> It proves that:</p>
        <ul>
          <li><strong>The message was NOT signed by the claimed address</strong> - Someone else created this signature
          </li>
          <li><strong>The message may have been altered</strong> - Even a single character change breaks the signature
          </li>
          <li><strong>The signature is invalid or corrupted</strong> - The cryptographic proof doesn't match</li>
        </ul>

        <p>This demonstrates the <strong>integrity protection</strong> of digital signatures. Unlike traditional
          signatures that can be forged,
          cryptographic signatures are mathematically impossible to fake without the private key.</p>

        <details>
          <summary>üî¨ Why This Is Secure</summary>
          <p>Bitcoin signatures use <strong>elliptic curve cryptography</strong> with the secp256k1 curve. To forge a
            signature, an attacker would need to:</p>
          <ul>
            <li>Solve the <strong>discrete logarithm problem</strong> (computationally infeasible)</li>
            <li>Find a hash collision in <strong>SHA-256</strong> (2^256 operations)</li>
            <li>Break the <strong>ECDSA algorithm</strong> (no known efficient method)</li>
          </ul>
          <p>These mathematical problems are so difficult that even with all the world's computing power,
            it would take longer than the age of the universe to break a single signature.</p>
        </details>
      </div>

      <div class="actions">
        <button
          type="button"
          onclick="document.getElementById('verify-dialog').showModal()"
          class="secondary"
        >Try Again</button>
      </div>
    </div>

    <!-- Verification Dialog -->
    <dialog id="verify-dialog">
      <article>
        <form
          method="get"
          id="verifyForm"
          action=""
        >
          <input
            required
            type="text"
            id="address"
            name="address"
            placeholder="Bitcoin Address"
          />
          <textarea
            required
            id="message"
            name="message"
            rows="9"
            placeholder="Message

It's a good idea to include on of these
- a timestamp
- opentimestamps.org
- the top bitcoin blockchain hash

Prefix hex strings with '0x'"
          ></textarea>
          <input
            type="text"
            id="signature"
            name="signature"
            required
            placeholder="Signature (Base64 encoded)"
          />
        </form>

        <footer>
          <button
            type="button"
            aria-label="Close"
            class="secondary"
            onclick="document.getElementById('verify-dialog').close()"
          >Cancel</button>
          <button
            type="submit"
            form="verifyForm"
            class="primary"
          >Verify</button>
        </footer>
      </article>
    </dialog>

    <!-- Educational Content -->
    <div class="education">
      <h2>üéì What Does a Digital Signature Prove?</h2>

      <p>A Bitcoin message signature cryptographically proves three important things:</p>

      <ul>
        <li><strong>Authentication:</strong> The message was signed by someone who controls the private key associated
          with the Bitcoin address</li>
        <li><strong>Integrity:</strong> The message has not been altered since it was signed</li>
        <li><strong>Non-repudiation:</strong> The signer cannot deny having signed the message</li>
      </ul>

      <p>This verification process uses <a
          href="https://en.wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm"
          target="_blank"
          rel="noopener noreferrer"
        >elliptic curve cryptography</a>
        and the same mathematical principles that secure the Bitcoin network itself.</p>

      <details>
        <summary>üî¨ Technical Details</summary>
        <p>This implementation uses:</p>
        <ul>
          <li><strong>secp256k1</strong> elliptic curve (same as Bitcoin)</li>
          <li><strong>RIPEMD-160</strong> and <strong>SHA-256</strong> hash functions</li>
          <li><strong>ECDSA signature recovery</strong> to derive the public key</li>
          <li><strong>Base58Check encoding</strong> for Bitcoin addresses</li>
        </ul>
        <p>All cryptographic functions are implemented in pure TypeScript without
          <a
            href="https://npmgraph.js.org/?q=verify-bitcoin-message"
            target="_blank"
            rel="noopener noreferrer"
          >external dependencies</a>.
          Learn more about <a
            href="https://en.wikipedia.org/wiki/Public-key_cryptography"
            target="_blank"
            rel="noopener noreferrer"
          >public-key cryptography</a>
          and <a
            href="https://en.wikipedia.org/wiki/Digital_signature"
            target="_blank"
            rel="noopener noreferrer"
          >digital signatures</a> on Wikipedia.
        </p>
      </details>
    </div>

    <div class="alternatives">
      <details>
        <summary
          role="button"
          class="secondary"
        >
          Verified Messages
        </summary>
        <p>
          To publish your verified message here, make
          <a
            href="https://github.com/mothepro/verify-bitcoin-message/pulls"
            target="_blank"
            rel="noopener noreferrer"
          >a pull request</a>
          that updates <code>tests/valid-payloads.json</code>
        </p>


        <ol id="valid-payloads"></ol>
      </details>
      <details>
        <summary
          role="button"
          class="secondary"
        >Source Code</summary>
        <a
          href="https://github.com/mothepro/verify-bitcoin-message"
          target="_blank"
          rel="noopener noreferrer"
        >
          <img
            alt="free and open source"
            src="https://img.shields.io/badge/source-open-success?style=for-the-badge"
          ></a>
        <a
          href="https://npmgraph.js.org/?q=verify-bitcoin-message"
          target="_blank"
          rel="noopener noreferrer"
        >
          <img
            alt="External Dependencies"
            src="https://img.shields.io/badge/dependencies-0-success?style=for-the-badge"
          ></a>
        <a
          href="https://github.com/mothepro/verify-bitcoin-message?tab=readme-ov-file#offline"
          target="_blank"
          rel="noopener noreferrer"
        >
          <img
            alt="Offline First"
            src="https://img.shields.io/badge/Internet_Required-No-success?style=for-the-badge"
          /></a>
        <img
          alt="Bundle Size"
          src="https://img.shields.io/badge/Bundle_Size-14kb-success?style=for-the-badge"
        />
        <!-- TODO replace with a payload instead :) -->
        <a href="bitcoin:bc1q4ctk3p0gwdhtmyytlcvkttz3epjrlectzx0w8s">
          <img
            alt="Donations to bc1q4ctk3p0gwdhtmyytlcvkttz3epjrlectzx0w8s"
            src="https://img.shields.io/badge/Donations-bc1q4ctk3p0gwdhtmyytlcvkttz3epjrlectzx0w8s-blue?style=for-the-badge"
          ></a>
      </details>
      <details
        class="hidden"
        id="json-stringify-details"
      >
        <summary
          role="button"
          class="secondary"
        >
          JSON</summary>
        <pre id="json-stringify"></pre>
      </details>
      <details>
        <summary
          role="button"
          class="secondary"
        >Alternative Message Verifiers</summary>
        <ul>
          <li>
            <a
              href="https://www.bitcoin.com/tools/verify-message/"
              target="_blank"
              rel="noopener noreferrer"
            >Bitcoin.com</a>
            <img
              alt="Static Badge"
              src="https://img.shields.io/badge/source-closed-red"
            >

          </li>
          <li>
            <a
              href="https://www.verifybitcoinmessage.com/"
              target="_blank"
              rel="noopener noreferrer"
            >Verify Bitcoin Message</a>
            <img
              alt="Static Badge"
              src="https://img.shields.io/badge/source-closed-red"
            >
          </li>
          <li>
            <a
              href="https://bluewallet.github.io/VerifySignature?a=&m=&s="
              id="blue-wallet-link"
              target="_blank"
              rel="noopener noreferrer"
            >BlueWallet's VerifySignature</a>
            <img
              alt="Static Badge"
              src="https://img.shields.io/badge/source-Open-success"
            >
            <img
              alt="Static Badge"
              src="https://img.shields.io/badge/Internet_Required-No-success"
            />
            <a
              href="https://npmgraph.js.org/?q=bitcoinjs-message"
              target="_blank"
              rel="noopener noreferrer"
            ><img
                alt="Static Badge"
                src="https://img.shields.io/badge/dependencies-68-yellow"
              ></a>
          </li>
        </ul>
      </details>
    </div>
  </main>

  <script
    type="module"
    src="./index.js"
  ></script>
</body>

</html>
